#!/bin/bash

# Typing practice script with real-time color feedback

sentences[0]="que hora son o que hora se"
sentences[1]="life is what happens when you’re busy making other plans."
sentences[2]="to be yourself in a world that is constantly trying to make you something else is the greatest accomplishment."
sentences[3]="it always seems impossible until it’s done."
sentences[4]="the only way to do great work is to love what you do."
sentences[5]="you miss 100% of the shots you don’t take."
sentences[6]="success is not final, failure is not fatal: it is the courage to continue that counts."
sentences[7]="believe you can and you’re halfway there."
sentences[8]="don’t watch the clock; do what it does. keep going."
sentences[9]="if you want to go fast, go alone. if you want to go far, go together."
sentences[10]="the only limit to our realization of tomorrow is our doubts of today."
sentences[11]="our greatest glory is not in never falling, but in rising every time we fall."
sentences[12]="the way to get started is to quit talking and begin doing."
sentences[13]="life is 10% what happens to us and 90% how we react to it."
sentences[14]="you can’t go back and change the beginning, but you can start where you are and change the ending."
sentences[15]="the best way to predict the future is to create it."
sentences[16]="don’t be pushed around by the fears in your mind. be led by the dreams in your heart."
sentences[17]="keep your face always toward the sunshine—and shadows will fall behind you."
sentences[18]="in the middle of every difficulty lies opportunity."
sentences[19]="you are never too old to set another goal or to dream a new dream."
sentences[20]="happiness depends upon ourselves."
sentences[21]="the only impossible journey is the one you never begin."
sentences[22]="life isn’t about waiting for the storm to pass, it’s about learning to dance in the rain."
sentences[23]="don’t limit your challenges, challenge your limits."
sentences[24]="the future belongs to those who believe in the beauty of their dreams."
sentences[25]="start where you are. use what you have. do what you can."
sentences[26]="you can never cross the ocean until you have the courage to lose sight of the shore."
sentences[27]="success is not how high you have climbed, but how you make a positive difference to the world."
sentences[28]="in the end, we will remember not the words of our enemies, but the silence of our friends."
sentences[29]="it does not matter how slowly you go as long as you do not stop."
sentences[30]="act as if what you do makes a difference. it does."
sentences[32]="success is not measured by what you accomplish, but by the obstacles you overcome and the persistence you show in the face of adversity, proving that resilience is the key to growth."
sentences[33]="life is not about waiting for opportunities to come to you, but about creating your own chances by stepping out of your comfort zone, pushing your limits, and embracing new challenges with an open heart and mind."
sentences[34]="the greatest challenge in life is not overcoming others, but overcoming your own self-doubt and fear, for it is only by believing in your own potential that you can truly achieve greatness."
sentences[35]="dreams are not meant to be chased alone; they are meant to be shared with those who inspire you, those who believe in you, and those who encourage you to never give up on what you truly desire."
sentences[36]="failure is not the end of the road, but merely a detour that teaches you valuable lessons, helping you to refine your strategy and emerge stronger and wiser than before."
sentences[37]="sometimes the greatest growth happens when you step into the unknown, embrace uncertainty, and trust that every experience, whether good or bad, is shaping you into the person you're meant to become."
sentences[38]="don’t wait for the perfect moment to begin; start where you are, with what you have, and trust that every small step will lead you closer to your ultimate goal, even if it seems impossible at first."
sentences[39]="true success comes not from the recognition of others, but from the satisfaction of knowing that you gave your best, learned from your mistakes, and never gave up on your dreams."
sentences[40]="it is not the years in your life that count, but the life in your years; embrace every moment, seize every opportunity, and make the most of every day you are given, for time is a gift that should never be wasted."
sentences[41]="the path to success is rarely a straight line; it is filled with twists, turns, and obstacles, but it is the determination to keep going, despite the setbacks, that leads to ultimate victory."
sentences[42]="don’t let fear of failure keep you from trying, for it is through our failures that we learn the most valuable lessons and build the resilience necessary to achieve success in the future."
sentences[43]="you don’t need to be perfect to be great, you just need to be willing to try, to learn from your mistakes, and to keep improving every day, no matter how small the progress may seem."
sentences[44]="the greatest thing you can do is not just to dream big, but to take concrete steps toward making those dreams a reality, no matter how challenging the journey may be."
sentences[45]="no matter how many times you fall, what matters is how many times you get back up, dust yourself off, and keep moving forward, for it is your resilience and perseverance that define your true strength."
sentences[46]="success is not found in the destination, but in the journey; it is the lessons you learn, the challenges you overcome, and the person you become along the way that make all the difference."
sentences[47]="your potential is limitless, but only if you are willing to push yourself beyond the boundaries of your comfort zone, take risks, and trust that you are capable of achieving more than you ever imagined."
sentences[48]="in a world full of distractions, the true key to success lies in your ability to stay focused on what truly matters, to remain disciplined, and to keep your eyes on the prize no matter the obstacles in your path."
sentences[49]="success comes to those who never give up, who continue to push forward even when the road ahead seems uncertain, and who trust that their hard work and dedication will eventually pay off."
sentences[50]="the most important investment you can make is in yourself—your skills, your growth, your mindset—and once you realize your own worth, there is no limit to what you can achieve."
sentences[51]="it is not the size of the dream that matters, but the size of the determination to make that dream come true, for determination and perseverance are the true fuels for success."
sentences[52]="life is not about avoiding failure, it’s about embracing it as a part of the process, learning from it, and using it as a stepping stone to build the life you desire and deserve."
sentences[53]="no matter how many times you are knocked down, it is your ability to rise again, stronger and more determined than ever, that will define your success in life."
sentences[54]="take time to appreciate the small victories along the way, for they are the building blocks that lead to the bigger accomplishments, and they remind you that every step counts."
sentences[55]="sometimes the hardest part is not the challenge itself, but the mindset you carry into it; believe in yourself, trust your abilities, and know that you are capable of overcoming anything."
sentences[56]="you are the architect of your own life; the choices you make today will shape the path you walk tomorrow, so choose wisely and take responsibility for the direction you wish to go."
sentences[57]="your life is your message to the world, so make it one of resilience, courage, and unwavering belief that anything is possible if you are willing to work for it."
sentences[58]="there are no shortcuts to success, only hard work, sacrifice, and the willingness to keep going even when the road seems long and difficult; perseverance is the key."
sentences[59]="success is not about avoiding failure, but about learning to fail forward, to use every setback as an opportunity to grow and improve, and to never stop believing in your ability to succeed."
sentences[60]="the beauty of life lies in its unpredictability, in the unexpected moments of joy, and in the strength we discover within ourselves when faced with challenges we never thought we could overcome."
sentences[61]="some rare letters are q v ., z x x"
sentences[62]="xi xa xex xx just tryna make you type x some more."

# # DIFFICULT
# sentences[63]="plus equals minus greater than less than shift left shift right;)"
# sentences[64]="array object dictionary list stack queue set map hash"
# sentences[65]="null undefined true false try catch throw final catch"
# sentences[66]="== === != <= >= < > += -= *= /= %="
# sentences[67]="assert validate process execute class method function variable"
# sentences[68]="continue break return yield async await promise resolve reject"
# sentences[69]="C# rusTYYY haha integer float string boolean char double constant variable"
# sentences[70]="public private protected static final synchronized transient"
# sentences[71]="module import export require nodejs react vuejs angular"
# sentences[72]="print log debug info error warning( hi ){ dhdh }"
# sentences[73]="event listener callback handler promise async await"
# sentences[74]="super this self base instance constructor"
# sentences[75]="cookie session token jwt api key authentication authorization"
# sentences[76]="Yo como, tu comes, el/ella come. i--"
# sentences[77]="process thread mutex lock unlock"
# sentences[78]="if else while for switch case break continue"
# sentences[78]="#include<stdio.h> int main (){ return 0; } c++"
# sentences[78]="while True echo Haha expected = + "


function calculate_time {
    local start=$1
    local end=$2
    local elapsed=$((end - start))
    echo "$elapsed"
}

function calculate_accuracy {
    local expected="$1"
    local actual="$2"

    local total_chars=${#expected}
    local correct_chars=0

    for ((i=0; i<${#actual}; i++)); do
        if [[ "${actual:i:1}" == "${expected:i:1}" ]]; then
            correct_chars=$((correct_chars + 1))
        fi
    done

    local accuracy=$(( (correct_chars * 100) / total_chars ))
    echo "$accuracy"
}

function count_mistyped_words {
    local expected="$1"
    local actual="$2"

    local IFS=' '
    local expected_words=($expected)
    local actual_words=($actual)
    
    local mistyped=0

    # Compare words
    for i in "${!expected_words[@]}"; do
        if [[ "${expected_words[i]}" != "${actual_words[i]}" ]]; then
            mistyped=$((mistyped + 1))
        fi
    done

    echo "$mistyped"
}

function calculate_wpm {
    local time_taken=$1
    local total_chars=$2

    # Calculate words per minute
    local wpm=$(( (total_chars / 5) * 60 / time_taken ))
    echo "$wpm"
}

function typing_practice {
    clear
    local sentence="$1"
    echo "Type the following sentence (press Esc when done):"
    echo
    echo "$sentence"
    echo

    local user_input=""
    local i=0
    local total_chars=0

    # Configure terminal to raw mode to handle key inputs manually
    stty -echo -icanon time 0 min 1

    start_time=$(date +%s)

    while true; do
        char=$(dd bs=1 count=1 2>/dev/null)

        # Handle Esc key (finish input)
        if [[ "$char" == $'\x1b' ]]; then
            break
        fi

        # Handle Backspace key
        if [[ "$char" == $'\x7f' ]]; then
            if [[ ${#user_input} -gt 0 ]]; then
                user_input="${user_input:0:-1}"
                echo -ne "\b \b" # Move back, clear character, and move back again
                ((i--))
            fi
            continue
        fi

        # Compare typed character with target sentence
        if [[ "$i" -lt "${#sentence}" ]]; then
            if [[ "${sentence:i:1}" == "$char" ]]; then
                printf "\e[32m%s\e[0m" "$char" # Green for correct
            else
                printf "\e[31m%s\e[0m" "$char" # Red for incorrect
            fi
        else
            printf "\e[31m%s\e[0m" "$char" # Red for extra characters
        fi

        user_input+="$char"
        total_chars=$((total_chars + 1))  # Count the total characters typed
        ((i++))
    done

    # Restore terminal to normal mode
    stty sane

    echo # Move to the next line

    end_time=$(date +%s)

    # Calculate statistics
    time_taken=$(calculate_time "$start_time" "$end_time")
    accuracy=$(calculate_accuracy "$sentence" "$user_input")
    mistyped_words=$(count_mistyped_words "$sentence" "$user_input")
    wpm=$(calculate_wpm "$time_taken" "$total_chars")

    # Display results with vibrant colors
    echo
    if [[ "$user_input" == "$sentence" ]]; then
        echo -e "\e[34mGreat job! You typed it correctly.\e[0m" # Blue for success
    else
        echo -e "\e[33mOops! There were some mistakes.\e[0m"  # Yellow for mistakes
    fi

    echo
    echo -e "\e[1;35mStatistics:\e[0m"  # Purple for the statistics heading
    echo -e "Time taken: \e[1;33m${time_taken} seconds\e[0m"  # Yellow for time
    echo -e "Accuracy: \e[1;36m${accuracy}%\e[0m"  # Cyan for accuracy
    echo -e "Mistyped words: \e[1;31m$mistyped_words\e[0m"  # Red for mistyped words
    echo -e "Typing Speed: \e[1;32m${wpm} WPM\e[0m"  # Green for typing speed
    echo
}

function display_summary {
    local total_attempts=$1
    local total_mistyped_words=$2
    local total_accuracy=$3
    local total_time=$4
    local total_wpm=$5

    echo -e "\e[1;32m=== Typing Practice Summary ===\e[0m"  # Green for header
    echo -e "Total attempts: \e[1;37m$total_attempts\e[0m"  # White for total attempts
    echo -e "Total mistyped words: \e[1;31m$total_mistyped_words\e[0m"  # Red for mistyped words
    echo -e "Average accuracy: \e[1;36m$((total_accuracy / total_attempts))%\e[0m"  # Cyan for average accuracy
    echo -e "Average time per sentence: \e[1;33m$((total_time / total_attempts)) seconds\e[0m"  # Yellow for average time
    echo -e "Average typing speed: \e[1;32m$((total_wpm / total_attempts)) WPM\e[0m"  # Green for average typing speed
    echo -e "\e[1;32m================================\e[0m"  # Green for footer
    echo
}

total_attempts=0
total_mistyped_words=0
total_accuracy=0
total_time=0
total_wpm=0

while true; do
    random_sentence=${sentences[$RANDOM % ${#sentences[@]}]}
    typing_practice "$random_sentence"

    total_attempts=$((total_attempts + 1))
    total_accuracy=$((total_accuracy + accuracy))
    total_mistyped_words=$((total_mistyped_words + mistyped_words))
    total_time=$((total_time + time_taken))
    total_wpm=$((total_wpm + wpm))

    echo "Do you want to try again? (y/n)"
    read -r choice
    if [[ "$choice" != "y" ]]; then
        display_summary "$total_attempts" "$total_mistyped_words" "$total_accuracy" "$total_time" "$total_wpm"
        echo "Goodbye!"
        break
    fi
done
